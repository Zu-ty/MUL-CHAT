<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUL-CONNECT - Users</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='users.css') }}">
</head>
<body>
    <header class="header">
        <img src="{{ url_for('static', filename='img/header-banner.png') }}" alt="Banner" class="header-img">
        <div class="profile-container">
            {% if session['username'] %}
                <div class="avatar">
                    {% if session.get('profile_pic') %}
                        <img src="{{ url_for('uploaded_file', filename=session['profile_pic']) }}" alt="Profile Pic">
                    {% else %}
                        <span>{{ session['username'][0].upper() }}</span>
                    {% endif %}
                </div>
                <a href="{{ url_for('profile') }}" class="username">{{ session['username'] }}</a>
            {% endif %}
            <a href="{{ url_for('logout') }}" class="logout">Logout</a>
        </div>
    </header>

    <main>
        <h2>Users Available</h2>
        <div class="users-list">
            {% for user in users %}
                <div class="user-card">
                    {% if user['profile_pic'] %}
                        <img src="{{ url_for('uploaded_file', filename=user['profile_pic']) }}" class="user-avatar">
                    {% else %}
                        <div class="user-avatar-letter">{{ user['username'][0].upper() }}</div>
                    {% endif %}
                    <span class="user-name">{{ user['username'] if user['username'] else user['email'] }}</span>
                    <a href="{{ url_for('chat', chat_id='0') }}?user_id={{ user['id'] }}" class="chat-btn">Chat</a>
                </div>
            {% endfor %}
        </div>

        <!-- Floating âž• button -->
        <div class="floating-btn" id="new-chat-btn">+</div>

        <!-- New Chat / Group Modal -->
        <div class="modal" id="new-chat-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-modal">&times;</span>
                <h3>Create New Chat / Group</h3>
                <form method="POST" action="{{ url_for('new_chat') }}">
                    <label>Chat Name (Optional for group)</label>
                    <input type="text" name="chat_name" placeholder="Group Name">
                    <label>Select Users</label>
                    <div class="users-checkbox">
                        {% for user in users %}
                            <label>
                                <input type="checkbox" name="user_ids" value="{{ user['id'] }}">
                                {{ user['username'] if user['username'] else user['email'] }}
                            </label>
                        {% endfor %}
                    </div>
                    <button type="submit">Create</button>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Floating modal logic
        const modal = document.getElementById('new-chat-modal');
        const btn = document.getElementById('new-chat-btn');
        const close = document.getElementById('close-modal');

        btn.onclick = () => modal.style.display = 'flex';
        close.onclick = () => modal.style.display = 'none';
        window.onclick = (e) => { if(e.target == modal) modal.style.display='none'; }
    </script>
</body>
  </html>
